/*! tooltip - v1.0 - 2013-05-25 4:53:31 PM
* Copyright (c) 2013 neekey; Licensed  */
KISSY.add("gallery/tooltip/1.0/index",function(a){var b=".J_TooltipArrow",c="center",d="center",e=0,f={top:"arrow-top",left:"arrow-left",right:"arrow-right",bottom:"arrow-bottom"},g=200,h="data-hide-timer";return{attach:function(b){var c=this,d=a.all(b.trigger),e=a.all(b.tooltip),f=b.onShow;d.each(function(d){d=a.one(d);var g=a.one(d.all(b.refer))||d;b.onShow=function(a,d){c.locate(g,e,b),f&&f(a,d)},c.connect(d,e,b)})},freeze:function(b){var c=a.one(b.tooltip),d=a.one(b.refer);this.locate(d,c,b),a.one(c).show()},connect:function(b,c,d){b=a.one(b),c=a.one(c),d=d||{};var e=d.onHide,f=d.onShow;b.on("mouseenter",function(){f&&f(b,c),clearTimeout(c.attr(h)),c.show()}),b.on("mouseleave",function(){c.attr(h,setTimeout(function(){e&&e(b,c),c.hide()},g))}),c.on("mouseover",function(){c.show(),clearTimeout(c.attr(h))}),c.on("mouseleave",function(){e&&e(b,c),c.hide()})},locate:function(g,h,i){g=a.one(g),h=a.one(h),i=i||{};var j=a.one(i.container),k=i.position;h.css({visibility:"hidden",position:"absolute"}),h.show();var l=i.gap||e,m=i.arrowHook||b,n=i.arrowAlign||c,o=i.align||d,p=h.all(m),q=a.one(window).height(),r=a.one(window).width(),s=a.DOM.scrollTop(),t=a.DOM.scrollLeft();j&&(q=j.outerHeight(),r=j.outerWidth(),s=j.scrollTop(),t=j.scrollLeft());var u=g.offset(),v=g.outerWidth(),w=g.outerHeight();j&&(u.left=u.left-j.offset().left,u.top=u.top-j.offset().top);var x=h.outerWidth(),y=h.outerHeight(),z=p.outerWidth(),A=p.outerHeight()/2;h.hide(),h.css("visibility","visible");var B={top:null,left:null,arrowPos:null,arrowTop:null,arrowLeft:null},C={};if(B={},B.top=u.top+w+l+A,B.left="center"==o?u.left+(v-x)/2:"left"==o?u.left:u.left+(v-x),B.arrowPos="top",B.arrowLeft="center"==n?u.left+v/2-z/2:"left"==n?u.left-z/2:u.left+v-z/2,C.bottom=B,B={},B.top=u.top-l-y-A,B.left="center"==o?u.left+(v-x)/2:"left"==o?u.left:u.left+(v-x),B.arrowPos="bottom",B.arrowLeft="center"==n?u.left+v/2-z/2:"left"==n?u.left-z/2:u.left+v-z/2,C.top=B,B={},B.left=u.left-l-x-z,B.top="center"==o?u.top+(w-y)/2:"left"==o?u.top:u.top+(w-y),B.arrowPos="right",B.arrowTop="center"==n?u.top+w/2-A/2:"left"==n?u.top-A/2:u.top+w-A/2,C.left=B,B={},B.left=u.left+v+l+z,B.top="center"==o?u.top+(w-y)/2:"left"==o?u.top:u.top+(w-y),B.arrowPos="left",B.arrowTop="center"==n?u.top+w/2-A/2:"left"==n?u.top-A/2:u.top+w-A/2,C.right=B,k&&C[k])B=C[k];else{var D,E,F,G;for(D in C)B=C[D],E=this._calculateArea(s,t,r,q,B.top,B.left,x,y),E=E.area,(!G||E>F)&&(G=D,F=E);B=C[G]}null!==B.arrowTop&&(B.top>B.arrowTop&&(B.arrowTop=B.top+A),B.arrowTop+A>B.top+y&&(B.arrowTop=B.top+y-3*A)),null!==B.arrowTop&&(B.arrowTop=B.arrowTop-B.top),null!==B.arrowLeft&&(B.left>B.arrowLeft&&(B.arrowLeft=B.left+z),B.arrowLeft+z>B.left+x&&(B.arrowLeft=B.left+x-3*z)),null!==B.arrowLeft&&(B.arrowLeft=B.arrowLeft-B.left),j?(j.css("position","relative"),j.append(h)):a.one(document.body).append(h),h.css({top:B.top,left:B.left}),p.removeClass(f.top),p.removeClass(f.left),p.removeClass(f.right),p.removeClass(f.bottom),p.addClass(f[B.arrowPos]),p.css({top:B.arrowTop||"",left:B.arrowLeft||""})},_calculateArea:function(a,b,c,d,e,f,g,h){var i=e>a?e:a,j=i==e,k=f>b?f:b,l=k==f,m=a+d>e+h?e+h:a+d,n=m==e+h,o=b+c>f+g?f+g:b+c,p=o==f+g;return{area:(o-k)*(m-i),ifIn:j&&l&&n&&p}}}});